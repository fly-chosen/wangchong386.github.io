---
layout: article
title:  "数据仓库数据仓库的简单介绍"
categories: DW
toc: true
image:
    teaser: /teaser/datawarehouse.jpg
---

> 本文介绍数据仓库以及维度建模分析，主要是对工作中用到的一些总结和感悟

### 前言
&emsp;&emsp;以下内容主要是通过在学习和工作中的一些总结和感悟，很多概念上的东西都主要来自于书籍和网络，毕竟这些基础知识还是以官网为准。
很早就想总结有关数据仓库建模方面的东西，趁着最近有时间，好好总结下这方面的知识。
## 概述
&emsp;&emsp;个人从事数据仓库已经有三年多了，其实在这个行业而来说，不管是从经验还是资历都是比较浅显的，主要从宏观层面说一说我对数据仓库的理解，如有纰漏，欢迎不吝赐教。
&emsp;&emsp;还有朋友希望推荐有关数据仓库方面的书籍，我就说下个人读过的两本不错的书
* [The Data Warehouse Toolkit, 3rd Edition](http://www.essai.rnu.tn/Ebook/Informatique/The%20Data%20Warehouse%20Toolkit,%203rd%20Edition.pdf) Published by John Wiley & Sons, Inc. 这本书主要从数据仓库的维度建模出发的，想要了解数据仓库的最基础可以推荐关注这本书，很适合初学者。
* [点击流数据仓库](https://book.douban.com/subject/1246297/) 作者：(美国)斯韦格特(SweigerMark) 译者：陆昌辉 等. 介绍了丰富的基于Web数据主题的详细知识.同时这本书的内容也给数据仓>库人员供一个通用的框架，该框架是任何点击流数据仓库工程的必备基础。也是从事互联网研究人员必看的一本书。大力推荐。
## 主要结构：
 1. 什么是数据仓库？
 2. 数据仓库与大数据的关系
 3. 事务型系统与数据仓库系统
 4. 构建数据仓库的流程
 5. 介绍下维度建模
 6. 学一点数据仓库知识好处

## 1. 什么是数据仓库？
&emsp;&emsp;数据仓库并不是什么新东西，它已经存在了几十年了，最早可以追溯到 60 年代，然后由数据仓库之父 Bill Inmon 与 80 年代提出被广泛接受的数据仓库定义：
{% highlight bash %}
{% raw %}
数据仓库是一个用于支持管理决策的面向主题的（Subject Oriented）、相对稳定的（Non-Volatile）、集成的（Integrate）、反映历史变化（Time Variant）的数据集合。
{% endraw %}
{% endhighlight %}

在没有数据仓库的支撑下，通常管理决策都更多的凭借管理者的感觉或者经验，有很大的可能导致决策失误而造成重大损失。
有了数据仓库后，我们就可以通过数据进行更合理的分析，结合历史记录，多维分析，帮助我们做更准确的判断，从而帮助企业抓住机会，降低损失，达到收益最大化。近来比较火数据驱动的概念也离>不开这个，通过充分挖掘数据的价值，让数据帮我们决策。
## 2. 数据仓库与大数据的关系
&emsp;&emsp;数据仓库诞生的时候还没有大数据的概念。所以本质上来说，数据仓库与大数据没有必然联系，数据仓库的存在并不依赖大数据。
不过随着互联网的发展，人们产生的数据越来越多，TB PG级的数据越来越常见，传统的技术无法处理如此大量的数据，所以数据仓库也需要引入大数据技术，作为数据仓库的一环，解决大数量下的存储
与分析问题，让数据仓库在大数据量下仍然高效。
就个人而言，我觉得数据仓库更多的是一套理念和架构方法，与数据量无关，而大数据技术则是为了这套理念和架构而服务。
## 3. 事务型系统与数据仓库系统
&emsp;&emsp;事务型系统也就是 OLTP 应用系统，它是我们接触最多的系统，这类系统的设计初衷就是为了满足快速的事务处理，比如购物，买票，秒杀等。系统处理的每一个请求，一般仅涉及一个或>者多个资源，能在很快的时间内完成请求处理并返回结果。
但一旦涉及到复杂的聚合统计查询，这类系统就比较难以处理了，比如要查询某一些类型的用户过去三个月购买最多的商品，因为同一时间需要查询大量数据，OLTP 系统并不擅长处理这类需求。
&emsp;&emsp;但数据仓库就不一样了，数据仓库的数据是按主题进行组织的，存储上做了专门的优化，每个主题的数据都是为了这个主题的分析而服务，它生来就是了进行复杂的聚合和统计，所以数据>仓库系统能在更短的时间内响应各种复杂的统计查询。
&emsp;&emsp;这里所谓的主题可以是销售额，可以是用户行为。通过对销售额的分析我们可以知道那些商品在什么时候对那些人销售量最高，通过对用户行为的分析我们可以知道那些人对那些功能最为>常用，粘度最高，诸如此类。
## 4. 构建数据仓库的流程
&emsp;&emsp;数据仓库的构建是有一些最佳流程和实践的，正确的流程能让数据仓库的构建事半功倍，降低成本，构建一个数据仓库系统主要涉及如下几个步骤。
### 4.1 收集商业需求（Business Requirements）
&emsp;&emsp;前面我们说到，数据仓库的目的是为了支持管理决策，所以我们在构建数据仓库的时候首先需要考虑的做的是收集商业需求，深入理解企业的各个业务流程（Business Process），抓住核>心需求，为数据仓库的建立提供指导方向，这样才能反过来为业务提供更好的决策数据支撑，让数据仓库价值的最大化。
### 4.2 进行数据建模
&emsp;&emsp;深入理解业务之后就可以着手建立数据模型了，因为一个企业可能有多个产品线，而一个产品一般会涉及多个业务流程。所以建立数据模型首先需要选择一个业务流程，然后针对这个流程>选取合适数据、合理的纬度进行建模。建模的合理与否，直接影响到将来进行数据分析的效果以及系统的扩展性。
因为分析需求总是多种多样、猝不及防的，只有建立合适的数据模型，才能更加从容的面对未来多变的分析需求，建模的重要性可见一斑。
### 4.3 数据加工与处理
&emsp;&emsp;完成数据建模之后就可以进行数据的加工和处理了，数据仓库里我们称之为ETL（Extraction, Transformation, and Loading）流程，主要的工作是从各个业务系统或者日志系统提取数据>，并做必要的转换，保证数据的正确性，然后加载到数据仓库系统中，以便之后的查询和分析。
这个过程根据业务以及数据量的不同，复杂度天差地别。对于小系统来说，可能几个 SQL 语句，一个简单的脚本就能搞定，然后对于大型系统（大数据量），我们可能需要用到 Hadoop、Spark 之类的>大数据框架才能做好。
### 4.4 数据查询与分析
&emsp;&emsp;前面的流程完成之后就可以进行数据查询于分析了，这是最终展现出来的阶段，也是产生价值阶段。
数据分析可以通过数据仓库系统提供的查询语言完成，也可以基于这些查询语言编写 商业智能(Business Intelligence) 应用，提供可视化的报表，从而为管理决策提供支撑。
## 5. 介绍下维度建模
&emsp;&emsp;这里主要介绍下数据建模:
### 5.1 经典数据仓库模型
&emsp;&emsp;下面将分别介绍四种数据仓库模型，其中前三种模型分别对应了三本书：《数据仓库》、《数据仓库工具箱》和《数据架构 大数据 数据仓库以及Data Vault》，这三本书都有中文版，非>常巧的是，我只有三本数据仓库的书，正好对应了这三种理论。还有没有怎么接触过的Anchor模型，也可以一块看看
##### 5.1.1 实体关系（ER）模型
&emsp;&emsp;数据仓库之父Immon的方法从全企业的高度设计一个3NF模型，用实体加关系描述的数据模型描述企业业务架构，在范式理论上符合3NF，它与OLTP系统中的3NF的区别，在于数据仓库中的3NF上站在企业角度面向主题的抽象，而不是针对某个具体业务流程的实体对象关系抽象，它更多的是面向数据的整合和一致性治理，正如Immon所希望达到的：“single version of the truth”。
但是要采用此方法进行构建，也有其挑战：
(1) 需要全面了解企业业务和数据
(2) 实施周期非常长
(3) 对建模人员的能力要求也非常高
##### 5.1.2 维度模型
&emsp;&emsp;维度模型是数据仓库领域另一位大师Ralph Kimall所倡导，他的《The DataWarehouse Toolkit-The Complete Guide to Dimensona Modeling，中文名《数据仓库工具箱》，是数据仓库工>程领域最流行的数仓建模经典。维度建模以分析决策的需求出发构建模型，构建的数据模型为分析需求服务，因此它重点解决用户如何更快速完成分析需求，同时还有较好的大规模复杂查询的响应性能>。
&emsp;&emsp;典型的代表是我们比较熟知的星形模型，以及在一些特殊场景下适用的雪花模型。
##### 5.1.3 DataVault
&emsp;&emsp;DataVault是Dan Linstedt发起创建的一种模型方法论，它是在ER关系模型上的衍生，同时设计的出发点也是为了实现数据的整合，并非为数据决策分析直接使用。它强调建立一个可审计的
基础数据层，也就是强调数据的历史性可追溯性和原子性，而不要求对数据进行过度的一致性处理和整合；同时也基于主题概念将企业数据进行结构化组织，并引入了更进一步的范式处理来优化模型应>对源系统变更的扩展性。
&emsp;&emsp;它主要由：**Hub**（关键核心业务实体）、**Link**（关系）、**Satellite**（实体属性） 三部分组成 。
##### 5.1.4 Anchor模型
&emsp;&emsp;Anchor模型是由Lars. Rönnbäck设计的，初衷是设计一个高度可扩展的模型，核心思想：所有的扩展只是添加而不是修改，因此它将模型规范到6NF，基本变成了K-V结构模型。
&emsp;&emsp;Anchor模型由：Anchors 、Attributes 、Ties 、Knots 组成，相关细节可以参考《AnchorModeling-Agile Information Modeling in Evolving Data Environments》
### 5.2 维度建模介绍
##### 5.2.1 什么是维度建模
维度模型是数据仓库领域大师Ralph Kimall所倡导，他的《数据仓库工具箱》，是数据仓库工程领域最流行的数仓建模经典。维度建模以分析决策的需求出发构建模型，构建的数据模型为分析需求服务>，因此它重点解决用户如何更快速完成分析需求，同时还有较好的大规模复杂查询的响应性能.
我们换一种方式来解释什么是维度建模。学过数据库的童鞋应该都知道星型模型，星型模型就是我们一种典型的维度模型。我们在进行维度建模的时候会建一张事实表，这个事实表就是星型模型的中心>，然后会有一堆维度表，这些维度表就是向外发散的星星。那么什么是事实表、什么又是维度表吗，下面会专门来解释.
##### 5.2.2 维度建模的基本要素
&emsp;&emsp;维度建模中有一些比较重要的概念，理解了这些概念，基本也就理解了什么是维度建模.
(1)事实表
{% highlight bash %}
{% raw %}

发生在现实世界中的操作型事件，其所产生的可度量数值，存储在事实表中。从最低的粒度级别来看，事实表行对应一个度量事件，反之亦然

{% endraw %}
{% endhighlight %}


比如电商中发生了一次购买行为就可以理解为一个事实:
product name：product ID,product name，product price，else
user table：user ID,username，user sex，user email
Time table：Time ID,year,month
rfx table : rfx_id ,seller_id,product id, price,pay_date,GMV
上面的订单表就是一个事实表，你可以理解他就是在现实中发生的一次操作型事件，我们每完成一个订单，就会在订单中增加一条记录
我们可以回过头再看一下事实表的特征，在维度表里没有存放实际的内容，他是一堆主键的集合，这些ID分别能对应到维度表中的一条记录
(2) 维度表
{% highlight bash %}
{% raw %}

每个维度表都包含单一的主键列。维度表的主键可以作为与之关联的任何事实表的外键，当然，维度表行的描述环境应与事实表行完全对应。 维度表通常比较宽，是扁平型非规范表，包含大量的低粒度
的文本属性。

{% endraw %}
{% endhighlight %}


&emsp;&emsp;用户表、商家表、时间表这些都属于维度表，这些表都有一个唯一的主键，然后在表中存放了详细的数据信息。
## 6. 学一点数据仓库知识好处

&emsp;&emsp;数据仓库通过对数据进行建模和重新组织，使得数据能够更容易的被统计和分析，为数据统计分析提供了一个新的思路与理念。即便我们不用数据仓库做前文提到的更宏观的目的，数据仓>库也能为我们提供一个不一样的思路，可以用在系统设计过程中，让系统更简单高效。

